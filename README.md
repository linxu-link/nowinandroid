![Now in Android](docs/images/nia-splash.jpg "Now in Android")

<a href="https://play.google.com/store/apps/details?id=com.google.samples.apps.nowinandroid"><img src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png" height="70"></a>

Now in Android åº”ç”¨
==================

**äº†è§£æ­¤åº”ç”¨çš„è®¾è®¡å’Œæ„å»ºè¿‡ç¨‹ï¼Œè¯·å‚é˜…[è®¾è®¡æ¡ˆä¾‹ç ”ç©¶](https://goo.gle/nia-figma)ã€[æ¶æ„å­¦ä¹ ä¹‹æ—…](docs/ArchitectureLearningJourney.md)å’Œ[æ¨¡å—åŒ–å­¦ä¹ ä¹‹æ—…](docs/ModularizationLearningJourney.md)ã€‚**

è¿™æ˜¯ [Now in Android](https://developer.android.com/series/now-in-android) åº”ç”¨çš„ä»£ç ä»“åº“ã€‚è¿™æ˜¯ä¸€ä¸ª**æ­£åœ¨å¼€å‘ä¸­**çš„é¡¹ç›® ğŸš§ã€‚

**Now in Android** æ˜¯ä¸€ä¸ªå®Œå…¨åŸºäº Kotlin å’Œ Jetpack Compose æ„å»ºçš„ Android åº”ç”¨ã€‚å®ƒéµå¾ª Android è®¾è®¡å’Œå¼€å‘æœ€ä½³å®è·µï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›æœ‰ç”¨çš„å‚è€ƒã€‚ä½œä¸ºä¸€ä¸ªè¿è¡Œä¸­çš„åº”ç”¨ï¼Œå®ƒæ—¨åœ¨é€šè¿‡æä¾›å®šæœŸçš„æ–°é—»æ›´æ–°ï¼Œå¸®åŠ©å¼€å‘è€…äº†è§£ Android å¼€å‘é¢†åŸŸçš„æœ€æ–°åŠ¨æ€ã€‚

è¯¥åº”ç”¨ç›®å‰æ­£åœ¨å¼€å‘ä¸­ã€‚`prodRelease` å˜ä½“å·²åœ¨ Play å•†åº—ä¸Šçº¿ã€‚

# åŠŸèƒ½ç‰¹ç‚¹

**Now in Android** å±•ç¤ºæ¥è‡ª
[Now in Android](https://developer.android.com/series/now-in-android) ç³»åˆ—çš„å†…å®¹ã€‚ç”¨æˆ·å¯ä»¥æµè§ˆæœ€è¿‘è§†é¢‘ã€æ–‡ç« å’Œå…¶ä»–å†…å®¹çš„é“¾æ¥ã€‚ç”¨æˆ·è¿˜å¯ä»¥å…³æ³¨è‡ªå·±æ„Ÿå…´è¶£çš„è¯é¢˜ï¼Œå¹¶åœ¨å‘å¸ƒä¸å…¶å…³æ³¨å…´è¶£åŒ¹é…çš„æ–°å†…å®¹æ—¶æ”¶åˆ°é€šçŸ¥ã€‚

## æˆªå›¾

![æˆªå›¾æ˜¾ç¤º"ä¸ºä½ æ¨è"å±å¹•ã€"å…´è¶£"å±å¹•å’Œ"è¯é¢˜è¯¦æƒ…"å±å¹•](docs/images/screenshots.png "æˆªå›¾æ˜¾ç¤º"ä¸ºä½ æ¨è"å±å¹•ã€"å…´è¶£"å±å¹•å’Œ"è¯é¢˜è¯¦æƒ…"å±å¹•")

# å¼€å‘ç¯å¢ƒ

**Now in Android** ä½¿ç”¨ Gradle æ„å»ºç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ Android Studioï¼ˆè¯·ç¡®ä¿ä½¿ç”¨[æ­¤å¤„](https://developer.android.com/studio)æä¾›çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼‰ã€‚

å°†è¿è¡Œé…ç½®æ›´æ”¹ä¸º `app`ã€‚

![image](https://user-images.githubusercontent.com/873212/210559920-ef4a40c5-c8e0-478b-bb00-4879a8cf184a.png)

å¯ä»¥æ„å»ºå’Œè¿è¡Œ `demoDebug` å’Œ `demoRelease` æ„å»ºå˜ä½“ï¼ˆ`prod` å˜ä½“ä½¿ç”¨åç«¯æœåŠ¡å™¨ï¼Œç›®å‰æš‚æœªå…¬å¼€ï¼‰ã€‚

![image](https://user-images.githubusercontent.com/873212/210560507-44045dc5-b6d5-41ca-9746-f0f7acf22f8e.png)

å¯åŠ¨è¿è¡Œåï¼Œæ‚¨å¯ä»¥å‚é˜…ä¸‹é¢çš„å­¦ä¹ ä¹‹æ—…ï¼Œæ›´å¥½åœ°äº†è§£æ‰€ä½¿ç”¨çš„åº“å’Œå·¥å…·ã€UIã€æµ‹è¯•ã€æ¶æ„ç­‰æ–¹æ³•çš„èƒŒåæ€è€ƒï¼Œä»¥åŠé¡¹ç›®çš„å„ä¸ªéƒ¨åˆ†å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ã€‚

# æ¶æ„

**Now in Android** åº”ç”¨éµå¾ª[å®˜æ–¹æ¶æ„æŒ‡å—](https://developer.android.com/topic/architecture)ï¼Œè¯¦ç»†è¯´æ˜è§[æ¶æ„å­¦ä¹ ä¹‹æ—…](docs/ArchitectureLearningJourney.md)ã€‚

# æ¨¡å—åŒ–

**Now in Android** åº”ç”¨å·²å®Œå…¨æ¨¡å—åŒ–ï¼Œè¯¦ç»†çš„æ¨¡å—åŒ–ç­–ç•¥æŒ‡å—å’Œè¯´æ˜è§[æ¨¡å—åŒ–å­¦ä¹ ä¹‹æ—…](docs/ModularizationLearningJourney.md)ã€‚

# æ„å»º

åº”ç”¨åŒ…å«å¸¸è§„çš„ `debug` å’Œ `release` æ„å»ºå˜ä½“ã€‚

æ­¤å¤–ï¼Œ`app` çš„ `benchmark` å˜ä½“ç”¨äºæµ‹è¯•å¯åŠ¨æ€§èƒ½å¹¶ç”ŸæˆåŸºçº¿é…ç½®æ–‡ä»¶ï¼ˆæ›´å¤šä¿¡æ¯è§ä¸‹æ–‡ï¼‰ã€‚

`app-nia-catalog` æ˜¯ä¸€ä¸ªç‹¬ç«‹åº”ç”¨ï¼Œç”¨äºå±•ç¤ºä¸º **Now in Android** å®šåˆ¶è®¾è®¡çš„ç»„ä»¶åˆ—è¡¨ã€‚

åº”ç”¨è¿˜ä½¿ç”¨[äº§å“é£å‘³](https://developer.android.com/studio/build/build-variants#product-flavors)æ¥æ§åˆ¶åº”ç”¨å†…å®¹çš„åŠ è½½æ¥æºã€‚

`demo` é£å‘³ä½¿ç”¨é™æ€æœ¬åœ°æ•°æ®ï¼Œä»¥ä¾¿ç«‹å³æ„å»ºå’Œæ¢ç´¢ UIã€‚

`prod` é£å‘³å‘åç«¯æœåŠ¡å™¨å‘èµ·çœŸå®ç½‘ç»œè¯·æ±‚ï¼Œæä¾›æœ€æ–°å†…å®¹ã€‚ç›®å‰æš‚æ— å…¬å¼€çš„åç«¯æœåŠ¡ã€‚

å¸¸è§„å¼€å‘è¯·ä½¿ç”¨ `demoDebug` å˜ä½“ã€‚UI æ€§èƒ½æµ‹è¯•è¯·ä½¿ç”¨ `demoRelease` å˜ä½“ã€‚

# æµ‹è¯•

ä¸ºäº†ä¾¿äºç»„ä»¶æµ‹è¯•ï¼Œ**Now in Android** ä½¿ç”¨ [Hilt](https://developer.android.com/training/dependency-injection/hilt-android) è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚

å¤§å¤šæ•°æ•°æ®å±‚ç»„ä»¶å®šä¹‰ä¸ºæ¥å£ã€‚ç„¶åï¼Œå…·ä½“å®ç°ï¼ˆå…·æœ‰å„ç§ä¾èµ–é¡¹ï¼‰ç»‘å®šä»¥å‘åº”ç”¨ä¸­çš„å…¶ä»–ç»„ä»¶æä¾›è¿™äº›æ¥å£ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œ**Now in Android** ä¸ä½¿ç”¨ä»»ä½•æ¨¡æ‹Ÿåº“ã€‚ç›¸åï¼Œå¯ä»¥ä½¿ç”¨ Hilt çš„æµ‹è¯• API ç”¨æµ‹è¯•æ›¿èº«æ›¿æ¢ç”Ÿäº§å®ç°ï¼ˆæˆ–é€šè¿‡æ‰‹åŠ¨æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œ ViewModel æµ‹è¯•ï¼‰ã€‚

è¿™äº›æµ‹è¯•æ›¿èº«å®ç°ä¸ç”Ÿäº§å®ç°ç›¸åŒçš„æ¥å£ï¼Œé€šå¸¸æä¾›ç®€åŒ–çš„ï¼ˆä½†ä»çœŸå®ï¼‰å®ç°å¹¶å¸¦æœ‰é¢å¤–çš„æµ‹è¯•é’©å­ã€‚è¿™ä¼šäº§ç”Ÿæ›´ç¨³å®šçš„æµ‹è¯•ï¼Œå¯èƒ½ä¼šæ‰§è¡Œæ›´å¤šç”Ÿäº§ä»£ç ï¼Œè€Œä¸æ˜¯ä»…ä»…éªŒè¯å¯¹æ¨¡æ‹Ÿå¯¹è±¡çš„ç‰¹å®šè°ƒç”¨ã€‚

ç¤ºä¾‹ï¼š

- åœ¨ä»ªå™¨æµ‹è¯•ä¸­ï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤¹å­˜å‚¨ç”¨æˆ·åå¥½ï¼Œæ¯æ¬¡æµ‹è¯•åéƒ½ä¼šæ¸…é™¤ã€‚è¿™å…è®¸ä½¿ç”¨çœŸå®çš„ DataStore å¹¶æ‰§è¡Œæ‰€æœ‰ç›¸å…³ä»£ç ï¼Œè€Œä¸æ˜¯æ¨¡æ‹Ÿæ•°æ®æ›´æ–°æµç¨‹ã€‚

- æ¯ä¸ªå­˜å‚¨åº“éƒ½æœ‰ `Test` å®ç°ï¼Œå®ƒä»¬å®ç°æ­£å¸¸çš„å®Œæ•´å­˜å‚¨åº“æ¥å£å¹¶æä¾›ä»…æµ‹è¯•çš„é’©å­ã€‚ViewModel æµ‹è¯•ä½¿ç”¨è¿™äº› `Test` å­˜å‚¨åº“ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»…æµ‹è¯•çš„é’©å­æ¥æ“ä½œ `Test` å­˜å‚¨åº“çš„çŠ¶æ€å¹¶éªŒè¯ç»“æœè¡Œä¸ºï¼Œè€Œä¸æ˜¯æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº†ç‰¹å®šçš„å­˜å‚¨åº“æ–¹æ³•ã€‚

è¦è¿è¡Œæµ‹è¯•ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹ gradle ä»»åŠ¡ï¼š

- `testDemoDebug` è¿è¡Œé’ˆå¯¹ `demoDebug` å˜ä½“çš„æ‰€æœ‰æœ¬åœ°æµ‹è¯•ã€‚æˆªå›¾æµ‹è¯•ä¼šå¤±è´¥ï¼ˆè§ä¸‹æ–¹è§£é‡Šï¼‰ã€‚ä¸ºé¿å…æ­¤é—®é¢˜ï¼Œè¯·åœ¨è¿è¡Œå•å…ƒæµ‹è¯•ä¹‹å‰è¿è¡Œ `recordRoborazziDemoDebug`ã€‚
- `connectedDemoDebugAndroidTest` è¿è¡Œé’ˆå¯¹ `demoDebug` å˜ä½“çš„æ‰€æœ‰ä»ªå™¨æµ‹è¯•ã€‚

> [!NOTE]
> æ‚¨ä¸åº”è¯¥è¿è¡Œ `./gradlew test` æˆ– `./gradlew connectedAndroidTest`ï¼Œå› ä¸ºè¿™å°†é’ˆå¯¹æ‰€æœ‰æ„å»ºå˜ä½“æ‰§è¡Œæµ‹è¯•ï¼Œè¿™æ—¢ä¸å¿…è¦ä¹Ÿä¼šå¯¼è‡´å¤±è´¥ï¼Œå› ä¸ºåªæœ‰ `demoDebug` å˜ä½“å—æ”¯æŒã€‚å…¶ä»–å˜ä½“æ²¡æœ‰ä»»ä½•æµ‹è¯•ï¼ˆå°½ç®¡å°†æ¥å¯èƒ½ä¼šæ”¹å˜ï¼‰ã€‚

## æˆªå›¾æµ‹è¯•
æˆªå›¾æµ‹è¯•ä¼šå¯¹åº”ç”¨ä¸­çš„å±å¹•æˆ– UI ç»„ä»¶è¿›è¡Œæˆªå›¾ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰è®°å½•çš„å·²çŸ¥æ­£ç¡®æ¸²æŸ“çš„æˆªå›¾è¿›è¡Œæ¯”è¾ƒã€‚

ä¾‹å¦‚ï¼ŒNow in Android æœ‰[æˆªå›¾æµ‹è¯•](https://github.com/android/nowinandroid/blob/main/app/src/testDemo/kotlin/com/google/samples/apps/nowinandroid/ui/NiaAppScreenSizesScreenshotTests.kt)æ¥éªŒè¯ä¸åŒå±å¹•å°ºå¯¸ä¸‹å¯¼èˆªçš„æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®ï¼ˆ[å·²çŸ¥æ­£ç¡®çš„æˆªå›¾](https://github.com/android/nowinandroid/tree/main/app/src/testDemo/screenshots)ï¼‰ã€‚

Now In Android ä½¿ç”¨ [Roborazzi](https://github.com/takahirom/roborazzi) å¯¹æŸäº›å±å¹•å’Œ UI ç»„ä»¶è¿è¡Œæˆªå›¾æµ‹è¯•ã€‚ä½¿ç”¨æˆªå›¾æµ‹è¯•æ—¶ï¼Œä»¥ä¸‹ gradle ä»»åŠ¡å¾ˆæœ‰ç”¨ï¼š

- `verifyRoborazziDemoDebug` è¿è¡Œæ‰€æœ‰æˆªå›¾æµ‹è¯•ï¼Œå°†æˆªå›¾ä¸å·²çŸ¥çš„æ­£ç¡®æˆªå›¾è¿›è¡ŒéªŒè¯ã€‚
- `recordRoborazziDemoDebug` è®°å½•æ–°çš„"å·²çŸ¥æ­£ç¡®"æˆªå›¾ã€‚å½“æ‚¨å¯¹ UI è¿›è¡Œäº†æ›´æ”¹å¹¶æ‰‹åŠ¨éªŒè¯æ¸²æŸ“æ­£ç¡®åï¼Œè¯·ä½¿ç”¨æ­¤å‘½ä»¤ã€‚æˆªå›¾å°†å­˜å‚¨åœ¨ `modulename/src/test/screenshots` ä¸­ã€‚
- `compareRoborazziDemoDebug` åˆ›å»ºå¤±è´¥æµ‹è¯•ä¸å·²çŸ¥æ­£ç¡®å›¾ç‰‡ä¹‹é—´çš„æ¯”è¾ƒå›¾ç‰‡ã€‚è¿™äº›ä¹Ÿå¯ä»¥åœ¨ `modulename/src/test/screenshots` ä¸­æ‰¾åˆ°ã€‚

> [!NOTE]
> **å…³äºæˆªå›¾æµ‹è¯•å¤±è´¥çš„è¯´æ˜**
> æ­¤ä»“åº“ä¸­å­˜å‚¨çš„å·²çŸ¥æ­£ç¡®æˆªå›¾æ˜¯åœ¨ CI ä¸Šä½¿ç”¨ Linux è®°å½•ã€‚å…¶ä»–å¹³å°å¯èƒ½ä¼šï¼ˆå¹¶ä¸”å¯èƒ½ä¼šï¼‰ç”Ÿæˆç•¥æœ‰ä¸åŒçš„å›¾åƒï¼Œå¯¼è‡´æˆªå›¾æµ‹è¯•å¤±è´¥ã€‚åœ¨é Linux å¹³å°ä¸Šï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨å¼€å§‹å·¥ä½œä¹‹å‰åœ¨ `main` åˆ†æ”¯ä¸Šè¿è¡Œ `recordRoborazziDemoDebug`ã€‚è¿›è¡Œæ›´æ”¹åï¼Œ`verifyRoborazziDemoDebug` å°†åªè¯†åˆ«çœŸæ­£çš„æ›´æ”¹ã€‚

æœ‰å…³æˆªå›¾æµ‹è¯•çš„æ›´å¤šä¿¡æ¯ï¼Œ[è¯·æŸ¥çœ‹æ­¤æ¼”è®²](https://www.droidcon.com/2023/11/15/easy-screenshot-testing-with-compose/)ã€‚

# UI

åº”ç”¨é‡‡ç”¨ [Material 3 æŒ‡å—](https://m3.material.io/)è®¾è®¡ã€‚è¯¦ç»†äº†è§£è®¾è®¡è¿‡ç¨‹å¹¶è·å–è®¾è®¡æ–‡ä»¶ï¼Œè¯·å‚é˜… [Now in Android Material 3 æ¡ˆä¾‹ç ”ç©¶](https://goo.gle/nia-figma)ï¼ˆè®¾è®¡èµ„æºä¹Ÿå¯ä½œä¸º PDF è·å–ï¼š[docs/Now-In-Android-Design-File.pdf](docs/Now-In-Android-Design-File.pdf)ï¼‰ã€‚

å±å¹•å’Œ UI å…ƒç´ å®Œå…¨ä½¿ç”¨ [Jetpack Compose](https://developer.android.com/jetpack/compose) æ„å»ºã€‚

åº”ç”¨æœ‰ä¸¤ä¸ªä¸»é¢˜ï¼š

- åŠ¨æ€é¢œè‰² - ä½¿ç”¨åŸºäºç”¨æˆ·å½“å‰é¢œè‰²ä¸»é¢˜çš„é¢œè‰²ï¼ˆå¦‚æœæ”¯æŒï¼‰
- é»˜è®¤ä¸»é¢˜ - å½“ä¸æ”¯æŒåŠ¨æ€é¢œè‰²æ—¶ä½¿ç”¨é¢„å®šä¹‰é¢œè‰²

æ¯ä¸ªä¸»é¢˜è¿˜æ”¯æŒæ·±è‰²æ¨¡å¼ã€‚

åº”ç”¨ä½¿ç”¨è‡ªé€‚åº”å¸ƒå±€æ¥[æ”¯æŒä¸åŒçš„å±å¹•å°ºå¯¸](https://developer.android.com/guide/topics/large-screens/support-different-screen-sizes)ã€‚

åœ¨[æ­¤å¤„](docs/ArchitectureLearningJourney.md#ui-layer)è¯¦ç»†äº†è§£ UI æ¶æ„ã€‚

# æ€§èƒ½

## åŸºå‡†æµ‹è¯•

ä½¿ç”¨ [`Macrobenchmark`](https://developer.android.com/topic/performance/benchmarking/macrobenchmark-overview) ç¼–å†™çš„æ‰€æœ‰æµ‹è¯•éƒ½åœ¨ `benchmarks` æ¨¡å—ä¸­ã€‚è¯¥æ¨¡å—è¿˜åŒ…å«ç”¨äºç”ŸæˆåŸºçº¿é…ç½®æ–‡ä»¶çš„æµ‹è¯•ã€‚

## åŸºçº¿é…ç½®æ–‡ä»¶

æ­¤åº”ç”¨çš„åŸºçº¿é…ç½®æ–‡ä»¶ä½äº [`app/src/main/baseline-prof.txt`](app/src/main/baseline-prof.txt)ã€‚
å®ƒåŒ…å«åœ¨åº”ç”¨å¯åŠ¨æœŸé—´å…³é”®ç”¨æˆ·è·¯å¾„å¯ç”¨ AOT ç¼–è¯‘çš„è§„åˆ™ã€‚

æœ‰å…³åŸºçº¿é…ç½®æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»[æ­¤æ–‡æ¡£](https://developer.android.com/studio/profile/baselineprofiles)ã€‚

> [!NOTE]
> éœ€è¦ä¸ºå½±å“åº”ç”¨å¯åŠ¨çš„å‘å¸ƒæ„å»ºé‡æ–°ç”ŸæˆåŸºçº¿é…ç½®æ–‡ä»¶ã€‚

è¦ç”ŸæˆåŸºçº¿é…ç½®æ–‡ä»¶ï¼Œè¯·é€‰æ‹© `benchmark` æ„å»ºå˜ä½“ï¼Œå¹¶åœ¨ AOSP Android æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œ `BaselineProfileGenerator` åŸºå‡†æµ‹è¯•ã€‚
ç„¶åå°†ç”Ÿæˆçš„åŸºçº¿é…ç½®æ–‡ä»¶ä»æ¨¡æ‹Ÿå™¨å¤åˆ¶åˆ° [`app/src/main/baseline-prof.txt`](app/src/main/baseline-prof.txt)ã€‚

## Compose ç¼–è¯‘å™¨æŒ‡æ ‡

è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å–å’Œåˆ†æ compose ç¼–è¯‘å™¨æŒ‡æ ‡ï¼š

```bash
./gradlew assembleRelease -PenableComposeCompilerMetrics=true -PenableComposeCompilerReports=true
```

æŠ¥å‘Šæ–‡ä»¶å°†æ·»åŠ åˆ° [build/compose-reports](build/compose-reports)ã€‚æŒ‡æ ‡æ–‡ä»¶ä¹Ÿå°†æ·»åŠ åˆ° [build/compose-metrics](build/compose-metrics)ã€‚

æœ‰å…³ Compose ç¼–è¯‘å™¨æŒ‡æ ‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[è¿™ç¯‡åšå®¢æ–‡ç« ](https://medium.com/androiddevelopers/jetpack-compose-stability-explained-79c10db270c8)ã€‚

# è®¸å¯è¯

**Now in Android** æ ¹æ® Apache è®¸å¯è¯ï¼ˆ2.0 ç‰ˆï¼‰çš„æ¡æ¬¾åˆ†å‘ã€‚è¯·å‚é˜…[è®¸å¯è¯](LICENSE)äº†è§£æ›´å¤šä¿¡æ¯ã€‚
